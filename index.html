# üìß SMTP Mail Server Setup Lab - Fresh Installation Guide

## Complete Step-by-Step with Screenshot & Explanation Requirements

> **PURPOSE:** This guide is designed for you to follow while setting up a FRESH Rocky Linux mail server and Ubuntu client. Take a screenshot after EVERY command and document what each command does.

---

## üéØ Lab Requirements

### What You Need

- ‚úÖ Fresh Rocky Linux VM (for mail server)
- ‚úÖ Fresh Ubuntu VM (for mail client)
- ‚úÖ VirtualBox NAT Network configured
- ‚úÖ Screenshot tool ready (Snipping Tool, ShareX, etc.)
- ‚úÖ This guide open on your host machine

### IP Configuration

- **Rocky Linux (Server):** 192.168.200.3
- **Ubuntu (Client):** 192.168.200.80
- **Gateway:** 192.168.200.2
- **Domain:** bungkus.org
- **FQDN:** bnaserver.bungkus.org

### User Account

- **Username:** dineesh
- **Password:** Lab2026

---

---

# PART 1: ROCKY LINUX SERVER SETUP

## Phase 1: Initial System Configuration

### Step 1: Create User Account

**Command/Action:** `sudo adduser dineesh`

**Purpose:** Creates a new system user account named "dineesh" that will be used for email authentication. Mail servers use Linux system accounts for user authentication.

**Result:** The system creates the user and prepares the home directory.

<img width="1320" height="213" alt="Screenshot 2026-02-05 090259" src="https://github.com/user-attachments/assets/384e72c5-a5a1-42f0-9115-d06b14108052" />

---

**Command/Action:** `sudo passwd dineesh`

**Purpose:** Sets the password "Lab2026" for the dineesh user account. This password will be used later for SMTP/IMAP authentication.

**Result:** The user password is successfully set and verified.

<img width="1569" height="384" alt="Screenshot 2026-02-05 091115" src="https://github.com/user-attachments/assets/b71a21fe-df88-4cf3-8120-29f38dea7112" />

---

### Step 2: Set Hostname

**Command/Action:** `sudo hostnamectl set-hostname bnaserver.bungkus.org`

**Purpose:** Sets the Fully Qualified Domain Name (FQDN) of the server, which is critical for identification, SSL certificates, and mail routing.

**Result:** The static hostname is updated for the server.

<img width="2074" height="184" alt="Screenshot 2026-02-05 091311" src="https://github.com/user-attachments/assets/555efc67-d7bd-4c9e-9fdc-82847b697bbb" />

---

**Command/Action:** `hostnamectl`

**Purpose:** Verifies the hostname was set correctly and displays general system information.

**Result:** Displays the static hostname as "bnaserver.bungkus.org".

**Notes:** If the command prompt still shows the old name, try closing and reopening the terminal.

<img width="1523" height="809" alt="Screenshot 2026-02-05 091411" src="https://github.com/user-attachments/assets/47f329a0-9e59-4baf-8e76-5ab1e5d90385" />

---

**Command/Action:** `hostname -f`

**Purpose:** Displays only the FQDN (Fully Qualified Domain Name) for a quick verification check.

**Result:** Outputs `bnaserver.bungkus.org`.

<img width="948" height="192" alt="Screenshot 2026-02-05 091438" src="https://github.com/user-attachments/assets/72db8e84-30b5-466c-b4e3-8d424b7dbd01" />

**Expected Output:** `bnaserver.bungkus.org`

---

### Step 3: Configure Hosts File

**Command/Action:** `sudo nano /etc/hosts`

**Purpose:** Opens the local hosts file to map IP addresses to hostnames, ensuring the server can resolve its own FQDN without external DNS.

**Result:** The nano editor opens the `/etc/hosts` file.

<img width="1242" height="146" alt="Screenshot 2026-02-05 091525" src="https://github.com/user-attachments/assets/9a1a0a64-72bb-47e0-b4c0-b089c22e88a0" />

<img width="2531" height="1529" alt="Screenshot 2026-02-05 091601" src="https://github.com/user-attachments/assets/f84f8b68-c2a4-4b2e-a9d3-cce78f9c3651" />

---

**Command/Action:** Add entry `192.168.200.3 bnaserver.bungkus.org bnaserver`

**Purpose:** Maps the server's IP to its FQDN locally, which is essential for mail services to identify themselves correctly.

**Result:** Local name resolution for the server's FQDN is established.

**Notes:** This manual mapping ensures the server can identify itself correctly even without a DNS server.

<img width="2226" height="277" alt="Screenshot 2026-02-05 091648" src="https://github.com/user-attachments/assets/839505f1-3441-4693-9332-c8b76dddce1a" />

---

**Command to Save:**

- Press `Ctrl + O` (WriteOut)
- Press `Enter` (Confirm filename)
- Press `Ctrl + X` (Exit)

<img width="2359" height="261" alt="Screenshot 2026-02-05 091753" src="https://github.com/user-attachments/assets/ffaa4f5a-77d8-4ba1-995f-de4af5ec2f8e" />

---

**Command/Action:** `cat /etc/hosts`

**Purpose:** Displays the contents of the hosts file to verify that the manual mapping was saved correctly.

**Result:** Shows the updated list of local IP-to-hostname mappings.

<img width="2230" height="295" alt="Screenshot 2026-02-05 091824" src="https://github.com/user-attachments/assets/8533d07e-0415-49c0-856f-61e9c0f3ee6e" />

---

### Step 4: Network Verification

**Command/Action:** `ip addr show`

**Purpose:** Displays all network interfaces and their assigned IP addresses to verify the static IP configuration.

**Result:** Confirms the 192.168.200.3 IP is correctly assigned to the interface.

<img width="2535" height="819" alt="Screenshot 2026-02-05 092005" src="https://github.com/user-attachments/assets/6e3beb8e-8abb-4896-904c-dc7505d93abb" />

---

**Command/Action:** `ip route`

**Purpose:** Shows the routing table to verify the default gateway is present, which is essential for external communication.

**Result:** Displays the current network routes and gateways.

**Notes:** If you do not see a "default via" line, the server will not be able to reach the internet or other networks.

---

**Command/Action:** `sudo ip route add default via 192.168.200.1 dev enp0s3`

**Purpose:** Manually restores the default gateway if it was missing after hostname changes.

**Result:** The default route is added back to the routing table.

**Notes:** Most VirtualBox NAT networks use 192.168.200.1 as the gateway. Only run this if the route was missing.

<img width="2216" height="150" alt="image" src="https://github.com/user-attachments/assets/1e953ed2-3539-4ebe-be22-629dccde2c2a" />

---

**Command/Action:** `ping -c 3 8.8.8.8`

**Purpose:** Tests basic internet connectivity by sending ICMP echo requests to Google's public DNS.

**Result:** Shows packet transmission and reception status (noting NAT limitations).

**Notes:** VirtualBox NAT networks often block ICMP (ping) packets. If this fails but `curl` works, your internet is fine.

---

**Command/Action:** `curl -I https://google.com`

**Purpose:** Tests web connectivity by fetching HTTP headers, providing a more reliable check than ping in NAT environments.

**Result:** Displays HTTP headers, confirming the server can reach the internet.

<img width="2537" height="962" alt="image" src="https://github.com/user-attachments/assets/4e1133e9-ae51-4446-bbe1-ebbb00ac01bb" />

---

### Step 5: Install Required Packages

**Command/Action:** `sudo dnf update -y`

**Purpose:** Updates all installed packages to ensure the system is secure and running the latest available versions.

**Result:** Packages are downloaded and updated automatically.

<img width="1228" height="141" alt="image" src="https://github.com/user-attachments/assets/2a8f8d8e-edb6-4eeb-baf6-3fb0dbb7d2c6" />

<img width="1629" height="1525" alt="image" src="https://github.com/user-attachments/assets/a104f412-28ff-4f0f-b09c-47ceedd0f479" />

---

**Command/Action:** `sudo dnf install postfix dovecot -y`

**Purpose:** Installs Postfix (MTA for SMTP) and Dovecot (IMAP/POP3 server) for handling email transmission and retrieval.

**Result:** Both mail server packages and their dependencies are installed.

<img width="1178" height="78" alt="image" src="https://github.com/user-attachments/assets/90f9cce7-ce3a-4178-b3da-1954ab372e5a" />

<img width="2538" height="1494" alt="image" src="https://github.com/user-attachments/assets/52e82512-7dd5-4b52-b4c9-791dc0e029bb" />

---

**Command/Action:** `rpm -qa | grep postfix`

**Purpose:** Verifies that the Postfix package was successfully installed on the system.

**Result:** Outputs the specific version of Postfix currently installed.

<img width="1277" height="238" alt="image" src="https://github.com/user-attachments/assets/c68570a5-3b9b-4977-b4c2-7654ac2dc420" />

**Expected Output:** `postfix-3.x.x-x.el9.x86_64` (version numbers may vary)

---

**Command/Action:** `rpm -qa | grep dovecot`

**Purpose:** Verifies that Dovecot and its core components were successfully installed.

**Result:** Outputs a list of installed Dovecot-related packages.

<img width="1219" height="252" alt="image" src="https://github.com/user-attachments/assets/8fe362b6-1953-46b4-b313-b3470840436c" />

**Expected Output:** Multiple dovecot packages (dovecot, dovecot-core, etc.)

---

## Phase 2: SSL/TLS Certificate Generation

### Step 6: Generate Self-Signed Certificate

**Command/Action:** Generate Self-Signed Certificate with `openssl`

**Purpose:** Creates a 365-day self-signed SSL/TLS certificate for secure SMTP/IMAP communication, using the FQDN for the Common Name.

**Result:** The `bnaserver.pem` (certificate) and `bnaserver.key` (private key) files are generated.

**Notes:** You must enter the server FQDN (`bnaserver.bungkus.org`) when prompted for the "Common Name".

---

**Command/Action:** `sudo ls -l /etc/pki/tls/certs/bnaserver.pem`

**Purpose:** Verifies that the certificate file was created and confirms its default permissions and file size.

**Result:** Shows the file metadata for the new certificate.

<img width="2151" height="221" alt="image" src="https://github.com/user-attachments/assets/939e5428-cfc4-41d4-b416-6195794bd76f" />

---

**Command/Action:** `sudo ls -l /etc/pki/tls/private/bnaserver.key`

**Purpose:** Verifies the creation of the sensitive private key file before setting restrictive permissions.

**Result:** Shows the file metadata for the new private key.

<img width="2197" height="233" alt="image" src="https://github.com/user-attachments/assets/c80f46f5-b5b2-42c4-bd75-c347fac25ea2" />

---

### Step 7: Set Proper Certificate Permissions

**Command/Action:** `sudo chmod 600 /etc/pki/tls/private/bnaserver.key`

**Purpose:** Secures the private key by restricting read/write access to the root user only, preventing unauthorized decryption of traffic.

**Result:** Private key permissions are successfully changed to 600.

<img width="2022" height="153" alt="image" src="https://github.com/user-attachments/assets/2d307ef2-ee57-4948-8d8a-ba706d7ede6c" />

---

**Command/Action:** `sudo chmod 644 /etc/pki/tls/certs/bnaserver.pem`

**Purpose:** Sets the certificate permissions to readable for all users, allowing mail clients to download and trust the public key.

**Result:** Certificate permissions are successfully changed to 644.

<img width="1979" height="181" alt="image" src="https://github.com/user-attachments/assets/ebdd51e8-4058-40b6-8d02-644911eb3f50" />

---

**Command/Action:** `sudo openssl x509 -in ... -text -noout`

**Purpose:** Displays human-readable details of the certificate to verify the Common Name (CN), validity dates, and issuer.

**Result:** Confirms the certificate details match the server's configuration.

<img width="2114" height="63" alt="image" src="https://github.com/user-attachments/assets/18269c2f-8ed9-41d7-b0e3-abd2d3983913" />

<img width="1063" height="1352" alt="image" src="https://github.com/user-attachments/assets/73b35baa-b961-49e0-9f2c-3cbc19ea5a53" />

---

## Phase 3: Postfix Configuration

### Step 8: Backup Original Configuration

**Command/Action:** `sudo cp /etc/postfix/main.cf /etc/postfix/main.cf.backup`

**Purpose:** Creates a backup of the original Postfix configuration file before making any changes.

**Result:** The original configuration is preserved as `main.cf.backup`.

<img width="2173" height="174" alt="image" src="https://github.com/user-attachments/assets/1e6e8fb5-42d9-4114-b741-dd34f94395e4" />

---

**Command/Action:** `ls -l /etc/postfix/main.cf*`

**Purpose:** Lists the configuration files to verify that the backup successfully exists.

**Result:** Shows both the current configuration and the backup file in the directory.

<img width="2012" height="351" alt="image" src="https://github.com/user-attachments/assets/bc5f6f55-c48f-47ad-a1c8-2b9124c77d1a" />

---

### Step 9: Edit Postfix Main Configuration

**Command/Action:** `sudo nano /etc/postfix/main.cf`

**Purpose:** Opens the main Postfix configuration file for editing to define server behavior.

**Result:** The `main.cf` file is opened for modification.

<img width="1468" height="109" alt="image" src="https://github.com/user-attachments/assets/408fa42a-38e5-45c6-9ce0-bb9a892bc7e8" />

---

**Configuration to Add/Modify:**

Find or add these lines (use Ctrl+W to search in nano):

```bash
# Basic Settings
myhostname = bnaserver.bungkus.org
mydomain = bungkus.org
myorigin = $mydomain
inet_interfaces = all
mydestination = $myhostname, localhost.$mydomain, localhost, $mydomain
home_mailbox = Maildir/

# Network Settings
mynetworks = 192.168.200.0/24, 127.0.0.0/8

# TLS/SSL Settings
smtpd_tls_cert_file = /etc/pki/tls/certs/bnaserver.pem
smtpd_tls_key_file = /etc/pki/tls/private/bnaserver.key
smtpd_tls_security_level = may
smtpd_tls_auth_only = yes
smtpd_tls_loglevel = 1

# SASL Authentication
smtpd_sasl_type = dovecot
smtpd_sasl_path = private/auth
smtpd_sasl_auth_enable = yes
smtpd_sasl_security_options = noanonymous
smtpd_sasl_local_domain = $myhostname
broken_sasl_auth_clients = yes


# Mailbox Format
home_mailbox = Maildir/

```

**Explanation of Each Section:**

**Basic Settings:**

- `myhostname`: Server's FQDN - identifies the server in SMTP conversations
- `mydomain`: Base domain name
- `myorigin`: Domain to append to mail from local users
- `inet_interfaces`: Which network interfaces to listen on (all = all interfaces)
- `mydestination`: Domains this server accepts mail for (as final destination)

**Network Settings:**

- `mynetworks`: Trusted networks that can relay mail (your local network + localhost)

**TLS/SSL Settings:**

- `smtpd_tls_cert_file`: Path to your SSL certificate (public key)
- `smtpd_tls_key_file`: Path to your private key
- `smtpd_tls_security_level = may`: Offer STARTTLS but don't require it (for port 25)
- `smtpd_tls_auth_only = yes`: Only allow authentication over encrypted connections
- `smtpd_tls_loglevel`: How much TLS info to log (1 = basic)

**SASL Authentication:**

- `smtpd_sasl_type = dovecot`: Use Dovecot for authentication
- `smtpd_sasl_path`: Socket path where Dovecot auth is listening
- `smtpd_sasl_auth_enable`: Enable SASL authentication
- `smtpd_sasl_security_options`: Disable anonymous authentication
- `broken_sasl_auth_clients`: Support for older mail clients

<img width="1918" height="502" alt="image" src="https://github.com/user-attachments/assets/401ac7fe-11ec-4ef3-81d6-ef4a18e0672d" />

<img width="634" height="95" alt="image" src="https://github.com/user-attachments/assets/5818ad15-fae4-48c7-93cf-c8413947261f" />

<img width="668" height="123" alt="image" src="https://github.com/user-attachments/assets/f197d458-7499-4c70-ae30-bf0c621b4aeb" />

<img width="2040" height="241" alt="image" src="https://github.com/user-attachments/assets/a2938f7a-5519-428a-ae64-5f5798c5f2df" />

<img width="1278" height="94" alt="image" src="https://github.com/user-attachments/assets/f04e2711-ee3d-48ab-adc5-0b575d30f5f9" />

<img width="1791" height="427" alt="image" src="https://github.com/user-attachments/assets/7367692e-2960-444c-8928-27797386931d" />

<img width="865" height="127" alt="image" src="https://github.com/user-attachments/assets/d6c4408d-056e-4499-a1a7-895852f953be" />

<img width="1176" height="355" alt="image" src="https://github.com/user-attachments/assets/aacf0735-c688-41ff-8ac2-91c894df3a57" />

<img width="779" height="155" alt="image" src="https://github.com/user-attachments/assets/ded09ec8-4802-4de9-b94f-88f8f8581bc0" />

---

**Action:** Save changes in nano (`Ctrl+O`, `Enter`) and Exit (`Ctrl+X`)

**Purpose:** Commits the Postfix main configuration changes to the disk and returns to the terminal.

**Result:** Configuration files are updated and the editor closes.

---

**Command/Action:** `sudo postconf -n`

**Purpose:** Displays only the customized (non-default) settings in Postfix to verify configuration accuracy.

**Result:** Shows a clean list of all manual Postfix configuration changes.

---

### Step 10: Configure Postfix Master (Ports Configuration)

**Command/Action:** `sudo cp /etc/postfix/master.cf /etc/postfix/master.cf.backup`

**Purpose:** Creates a backup of the master service configuration file before enabling mail submission ports.

**Result:** The `master.cf.backup` file is successfully created.

---

**Command/Action:** `sudo nano /etc/postfix/master.cf`

**Purpose:** Opens the Postfix master configuration file to configure specific network services and ports.

**Result:** The `master.cf` file is opened for editing.

---

**Action:** Configure Port 587 (Submission) sections in `master.cf`.

**Purpose:** Enables SMTP submission on port 587 with mandatory STARTTLS encryption and Dovecot SASL authentication.

**Result:** Postfix is now configured to handle secure client mail submission on port 587.

---

**Action:** Configure Port 465 (SMTPS) sections in `master.cf`.

**Purpose:** Enables SMTPS on port 465 using an immediate TLS wrapper for secure communication with older or specific clients.

**Result:** Postfix is now configured to handle immediate TLS connections on port 465.

---

**Action:** Save and Exit nano for `master.cf`.

**Purpose:** Saves the port configuration and returns to the command prompt.

**Result:** Port settings for 587 and 465 are finalized.

---

## Phase 4: Dovecot Configuration

### Step 11: Configure Dovecot Mail Location

**Command/Action:** `sudo nano /etc/dovecot/conf.d/10-mail.conf`

**Purpose:** Configures Dovecot to use the Maildir format in user home directories, matching the Postfix configuration.

**Result:** The Dovecot mail configuration file is opened.

---

**Action:** Set `mail_location = maildir:~/Maildir`

**Purpose:** Directs Dovecot to store and retrieve emails from the `Maildir` folder within each user's home directory.

**Result:** Dovecot is successfully synchronized with Postfix's storage format.

---

**Action:** Save and exit Dovecot mail configuration.

**Purpose:** Commits the mail location change.

**Result:** Dovecot mail location is updated.

---

### Step 12: Configure Dovecot SSL

**Command/Action:** `sudo nano /etc/dovecot/conf.d/10-ssl.conf`

**Purpose:** Opens Dovecot's SSL configuration to define certificate paths and encryption requirements.

**Result:** The Dovecot SSL configuration file is opened.

---

**Action:** Set SSL requirements and specify paths to `bnaserver.pem` and `bnaserver.key`.

**Purpose:** Secures Dovecot connections using the generated SSL/TLS certificates and forces encrypted communication.

**Result:** Dovecot is configured to use the server's private key and certificate for IMAP traffic.

---

**Action:** Save and exit Dovecot SSL configuration.

**Purpose:** Commits the SSL/TLS settings.

**Result:** SSL is enabled for Dovecot IMAP services.

---

### Step 13: Configure Dovecot Authentication

**Command/Action:** `sudo nano /etc/dovecot/conf.d/10-auth.conf`

**Purpose:** Configures user authentication mechanisms and restricts login security.

**Result:** The Dovecot authentication configuration file is opened.

<img width="2559" height="1572" alt="image" src="https://github.com/user-attachments/assets/30bfec94-e90a-40af-b5a5-9f789b63797d" />

---

**Action:** Enable `disable_plaintext_auth = yes` and `auth_mechanisms = plain login`.

**Purpose:** Disallows passwords over unencrypted links and defines the allowed SASL mechanisms for client logins.

**Result:** Authentication security is enforced.

**Notes:** Disabling plaintext auth ensures that user passwords cannot be intercepted in transit.

---

**Save and exit**

---

### Step 14: Configure Dovecot for Postfix SASL

**Command/Action:** `sudo nano /etc/dovecot/conf.d/10-master.conf`

**Purpose:** Configures the Dovecot master listener to provide an authentication socket for Postfix.

**Result:** The Dovecot master configuration file is opened.

---

**Action:** Configure the `service auth` section with a unix-listener for Postfix.

**Purpose:** Establishes a secure communication bridge so Postfix can use Dovecot to verify user credentials.

**Result:** Postfix is now integrated with Dovecot for unified authentication.

---

**Save and exit**

---

## Phase 5: Firewall Configuration

### Step 15: Configure Firewalld

**Command/Action:** `sudo firewall-cmd --list-all`

**Purpose:** Checks the current firewall configuration to see active services and ports before applying changes.

**Result:** Displays the initial firewall status.

---

**Command/Action:** `sudo firewall-cmd --permanent --add-service=smtp`

**Purpose:** Permits incoming SMTP traffic on port 25 through the firewall.

**Result:** The SMTP service is added to the permanent firewall rules.

---

**Command/Action:** `sudo firewall-cmd --permanent --add-service=smtps`

**Purpose:** Permits incoming SMTPS traffic on port 465 through the firewall.

**Result:** The SMTPS service is added to the permanent firewall rules.

---

**Command/Action:** `sudo firewall-cmd --permanent --add-port=587/tcp`

**Purpose:** Permits incoming mail submission traffic on port 587.

**Result:** Port 587 is added to the permanent firewall rules.

---

**Command/Action:** `sudo firewall-cmd --permanent --add-port=143/tcp`

**Purpose:** Permits incoming IMAP retrieval traffic on port 143.

**Result:** Port 143 is added to the permanent firewall rules.

---

**Command/Action:** `sudo firewall-cmd --permanent --add-port=993/tcp`

**Purpose:** Permits incoming IMAPS retrieval traffic on port 993.

**Result:** Port 993 is added to the permanent firewall rules.

---

**Command/Action:** `sudo firewall-cmd --reload`

**Purpose:** Applies all the new permanent firewall rules immediately.

**Result:** The firewall configuration is reloaded and active.

---

**Command/Action:** `sudo firewall-cmd --list-all`

**Purpose:** Verifies that all intended mail services and ports are now permitted in the active firewall configuration.

**Result:** Confirms ports 25, 465, 587, 143, and 993 are open.

---

## Phase 6: Start and Enable Services

### Step 16: Start Postfix

**Command/Action:** `sudo systemctl start postfix`

**Purpose:** Starts the Postfix mail server service to begin handling SMTP traffic.

**Result:** The Postfix service starts immediately.

---

**Command/Action:** `sudo systemctl status postfix`

**Purpose:** Verifies that Postfix is currently active and running without initialization errors.

**Result:** Service status is confirmed as "active (running)".

---

**Command/Action:** `sudo systemctl enable postfix`

**Purpose:** Configures the Postfix service to start automatically during the system boot process.

**Result:** Autostart for Postfix is enabled.

---

### Step 17: Start Dovecot

**Command/Action:** `sudo systemctl start dovecot`

**Purpose:** Starts the Dovecot IMAP server service to allow for mail retrieval.

**Result:** The Dovecot service starts immediately.

<img width="1451" height="221" alt="image" src="https://github.com/user-attachments/assets/bcfa87a8-d66d-45e8-8f4c-a8bb9e80f8a2" />

---

**Command/Action:** `sudo systemctl status dovecot`

**Purpose:** Verifies the operational status of Dovecot and checks for any startup errors.

**Result:** Service status is confirmed as "active (running)".

<img width="2537" height="1230" alt="image" src="https://github.com/user-attachments/assets/a6bc8901-1216-4a76-9af8-d72c668f7745" />

---

**Command/Action:** `sudo systemctl enable dovecot`

**Purpose:** Configures Dovecot to start automatically whenever the system boots.

**Result:** Autostart for Dovecot is enabled.

<img width="2530" height="286" alt="image" src="https://github.com/user-attachments/assets/7c120649-aa1a-48a5-a5cb-cad56e253b98" />

---

## Phase 7: Verification

### Step 18: Verify Listening Ports

**Command/Action:** `ss -tuln | grep -E '25|465|587|143|993'`

**Purpose:** Displays all listening TCP ports to verify the server is correctly bound to all 5 required mail services.

**Result:** Displays port 25, 465, 587, 143, and 993 in "LISTEN" status.

---

**Command/Action:** `sudo netstat -tlnp | grep -E 'postfix|dovecot'`

**Purpose:** Identifies which specific processes are listening on the mail ports to confirm service binding.

**Result:** Verifies that Postfix handles SMTP ports and Dovecot handles IMAP ports.

---

### Step 19: Test Local SMTP (Port 25)

**Command/Action:** `telnet localhost 25`

**Purpose:** Tests local unencrypted SMTP connectivity to verify the service is accepting connections and showing the correct banner.

**Result:** The Postfix banner appears, confirming port 25 is active.

**Expected Output:**

```
220 bnaserver.bungkus.org ESMTP Postfix
```

---

### Step 20: Test SMTP with STARTTLS

**Command/Action:** `openssl s_client -connect localhost:25 -starttls smtp`

**Purpose:** Verifies that the server correctly upgrades a connection on port 25 to TLS using the STARTTLS command.

**Result:** Confirms a successful SSL handshake and checks certificate validity.

**Notes:** Type `QUIT` and press Enter to close the connection after verifying success.

---

### Step 21: Test SMTPS (Port 465)

**Command/Action:** `openssl s_client -connect localhost:465`

**Purpose:** Verifies SMTPS connectivity on port 465, which uses immediate TLS encryption.

**Result:** Secure connection is established immediately after connecting.

**Type `QUIT` and Enter to exit**

---

### Step 22: Test Submission (Port 587)

**Command/Action:** `openssl s_client -connect localhost:587 -starttls smtp`

**Purpose:** Verifies that the mail submission port (587) is correctly configured for secure communication.

**Result:** Confirms successful secure connectivity for client mail submission.

**Notes:** This port is specifically used for mail submission from clients like Thunderbird.

---

### Step 23: Test IMAPS (Port 993)

**Command/Action:** `openssl s_client -connect localhost:993`

**Purpose:** Connects to the IMAPS port (993) to verify that Dovecot is providing encrypted IMAP services.

**Result:** Receives the secure Dovecot banner, confirming port 993 is operational.

**Expected Output:**

```
* OK [CAPABILITY IMAP4rev1 ...] Dovecot ready.
```

**Type `A1 LOGOUT` and Enter to exit**

---

### Step 24: Send Test Email Locally

**Command/Action:** Send Test Email via `openssl` (Port 25)

**Purpose:** Performs a complete end-to-end SMTP transaction locally to ensure the server can accept and process mail.

**Result:** The email is successfully accepted by the server and assigned a Queue ID.

---

**Then type these SMTP commands:**

```
EHLO localhost
MAIL FROM:<dineesh@bungkus.org>
RCPT TO:<dineesh@bungkus.org>
DATA
Subject: Test Email from SMTP Lab

This is a test email to verify the mail server is working.
.
QUIT
```

**Purpose:** Interacts with the SMTP server manually to send a test message using standard SMTP commands (EHLO, MAIL FROM, RCPT TO, DATA).

**Result:** End-to-end SMTP delivery is validated.

**Notes:** Pay close attention to the `.` (period) which must be on its own line to signal the end of the email content.

<img width="856" height="741" alt="image" src="https://github.com/user-attachments/assets/1a4e170e-a249-42ab-a031-94411f15f9e2" />

<img width="1733" height="650" alt="image" src="https://github.com/user-attachments/assets/57b2eeb8-aec2-4ee8-8936-ea4ab1b815fa" />

---

### Step 25: Verify Email Was Queued

**Command/Action:** `sudo mailq`

**Purpose:** Examines the mail queue to ensure the test email was successfully handed off for delivery and isn't stuck.

**Result:** Shows the current state of the mail queue (empty means processed).

---

**Command/Action:** `sudo tail -20 /var/log/maillog`

**Purpose:** Reviews the backend mail logs to trace the processing and final delivery status of the test email.

**Result:** Confirms the email was "sent" or "delivered" to the local mailbox.

---

### Step 26: Retrieve Email via IMAP

**Command/Action:** `openssl s_client -connect localhost:993 -quiet`

**Purpose:** Connects to IMAP securely to test the retrieval of the locally sent test email.

**Result:** Secure IMAP session is opened.

---

**Action:** Execute IMAP commands (`A1 LOGIN`, `A2 SELECT INBOX`, `A3 FETCH`, `A4 LOGOUT`).

**Purpose:** Authenticates with Dovecot and retrieves the specific test email to verify correct IMAP functionality.

**Result:** The full test email content is displayed in the terminal.

---

## üéâ Rocky Server Setup Complete

Your Rocky Linux mail server is now fully configured and tested!

---

# PART 2: UBUNTU CLIENT SETUP

## Phase 8: Ubuntu Client Configuration

### Step 27: Configure Hosts File on Ubuntu

**Command/Action:** `sudo nano /etc/hosts` (on Ubuntu)

**Purpose:** Opens the Ubuntu client's hosts file to add an entry for the Rocky Linux mail server.

**Result:** The hosts file is opened for editing.

---

**Action:** Add entry `192.168.200.3 bnaserver.bungkus.org`.

**Purpose:** Enables the Ubuntu client to resolve the mail server's hostname to its static IP address.

**Result:** Static name resolution for the server is configured on the client.

**Save and exit**

---

**Command/Action:** `cat /etc/hosts`

**Purpose:** Verifies that the mail server mapping was saved correctly in the Ubuntu host file.

**Result:** Displays the updated hosts file content.

---

### Step 27: Test Connectivity to Mail Server

**Command/Action:** `ping -c 3 bnaserver.bungkus.org`

**Purpose:** Verifies network connectivity and name resolution from the Ubuntu client to the mail server.

**Result:** Confirms the client can reach the server by its FQDN.

---

**Command/Action:** `telnet bnaserver.bungkus.org 25`

**Purpose:** Tests TCP connectivity to the SMTP service from the client machine.

**Result:** Receives the mail server banner, confirming the port is accessible.

---

**Command/Action:** `openssl s_client -connect bnaserver.bungkus.org:993`

**Purpose:** Verifies secure communication and checks the remote SSL certificate from the client perspective.

**Result:** Establishes a secure TLS connection to the Dovecot service.

---

## Phase 9: Thunderbird Installation

### Step 28: Download Thunderbird

**If using browser:**
Visit: <https://www.thunderbird.net/>

<img width="2539" height="233" alt="image" src="https://github.com/user-attachments/assets/2a12d926-7766-44c1-b39e-c82aa1fca3de" />

<img width="2426" height="1238" alt="image" src="https://github.com/user-attachments/assets/3700c775-d24f-453d-ad1d-c8aa2041d4a1" />

---

**Action:** Download latest Thunderbird archive.

**Purpose:** Acquires the installation files for the Thunderbird mail client.

**Result:** The archive is downloaded to the local workstation.

<img width="1244" height="344" alt="image" src="https://github.com/user-attachments/assets/c758ba46-3a07-432b-8eb6-5e049d8dd2ea" />

---

### Step 29: Extract Thunderbird

**Command/Action:** `tar -xvf thunderbird*.tar.xz`

**Purpose:** Extracts the Thunderbird application files from the downloaded archive.

**Result:** Application files are extracted into a `thunderbird` directory.

---

**Command/Action:** `ls -la thunderbird/`

**Purpose:** Verifies that the extraction was successful by listing the resulting directory structure.

**Result:** Shows the binary and resource files for Thunderbird.

---

### Step 30: Install Thunderbird

**Command/Action:** `sudo mv thunderbird /opt/`

**Purpose:** Installs Thunderbird by moving its folder to the standard `/opt/` location for third-party software.

**Result:** Thunderbird application folder is relocated to the system directory.

---

**Command/Action:** `sudo ln -sf /opt/thunderbird/thunderbird /usr/bin/thunderbird`

**Purpose:** Creates a symbolic link in the system path to allow launching Thunderbird from the terminal using a simple command.

**Result:** A global execution link for Thunderbird is established.

---

**Command/Action:** `which thunderbird`

**Purpose:** Verifies that the symbolic link is correctly configured and pointing to the expected binary path.

**Result:** Displays the path `/usr/bin/thunderbird`.

---

### Step 31: Launch Thunderbird

**Command/Action:** `thunderbird &`

**Purpose:** Launches the Thunderbird application in the background to begin the graphical configuration process.

**Result:** The Thunderbird application window opens while keeping the terminal active.

---

## Phase 10: Certificate Import & Thunderbird Configuration

### Step 32: Transfer Certificate to Client

**On Rocky Linux (Server):**

**Command/Action:** `sudo firewall-cmd --add-port=80/tcp` (on Server)

**Purpose:** Temporarily opens port 80 to allow the Ubuntu client to download the SSL certificate file.

**Result:** Port 80 is opened in the server's firewall.

**Notes:** Opening port 80 is a temporary measure designed solely for certificate retrieval by the client.

---

**Command/Action:** `sudo python3 -m http.server 80` (on Server)

**Purpose:** Launches a temporary web server to host the certificate file for retrieval by the client machine.

**Result:** The certificate directory is served over HTTP.

**Notes:** Press `Ctrl+C` in the terminal to stop the web server once the file has been downloaded.

---

**On Ubuntu (Client):**

1. Open Firefox
2. Visit: `http://192.168.200.3/bnaserver.pem`
3. Save the file to **Downloads**

<img width="800" height="264" alt="image" src="https://github.com/user-attachments/assets/93db93a7-2124-41b8-bbcb-7e6ba6f6744e" />

---

### Step 33: Import Certificate to Thunderbird

**Command/Action:** `thunderbird &`

**Purpose:** Launches Thunderbird to begin importing the certificate and configuring the user account.

**Result:** Thunderbird launches.

### Step 34: Configure Account & Server Settings

**Command/Action:** Configure account details and enter server settings manually in Thunderbird.

**Purpose:** Establishes the connection parameters for the dineesh account using the specified SMTP and IMAP ports.

**Result:** Server settings are accepted and advanced configuration begins.

<img width="983" height="874" alt="image" src="https://github.com/user-attachments/assets/66a1d0f6-9d21-4e95-8101-c071bb5484c5" />

<img width="973" height="341" alt="image" src="https://github.com/user-attachments/assets/7ba92fd4-e9b9-4f3a-a28e-9c49df315792" />

---

### Step 35: Import Certificate & Disable OCSP

**Command/Action:** Disable OCSP checks and import the `bnaserver.pem` certificate into the Authorities tab.

**Purpose:** Ensures Thunderbird trusts the self-signed certificate and doesn't attempt external revocation queries.

**Result:** The server's identity is verified and trusted by the client application.

**Notes:** Ensure you import the certificate into the "Authorities" tab and check "Trust this CA to identify websites" or similar options if prompted.

<img width="997" height="225" alt="image" src="https://github.com/user-attachments/assets/a6f4e624-2387-48eb-a8b2-85fbcbfdace8" />

<img width="990" height="554" alt="image" src="https://github.com/user-attachments/assets/69148fca-4da8-4fdc-b2dd-b577733fadc4" />

<img width="984" height="226" alt="image" src="https://github.com/user-attachments/assets/e451f9f7-ea66-4393-864f-018107f63f72" />

<img width="1002" height="460" alt="image" src="https://github.com/user-attachments/assets/a5809c86-8af8-4bc0-87d0-811412438257" />

<img width="990" height="597" alt="image" src="https://github.com/user-attachments/assets/f1d962c2-f0f1-4fe1-b6fa-77e4fc66a3c1" />

---

### Step 36: Finalize Connection & Handle Exception

**Command/Action:** Click "Get Messages" and confirm the Security Exception.

**Purpose:** Completes the first secure connection handshake by manually authorizing the self-signed certificate.

**Result:** IMAP connection is established and the inbox begins to load.

**Notes:** This security warning is expected because we are using a self-signed certificate rather than one from a public Authority.

<img width="968" height="530" alt="image" src="https://github.com/user-attachments/assets/fb4bca3f-d1ec-4e41-9c47-f313cffe639b" />

<img width="988" height="771" alt="image" src="https://github.com/user-attachments/assets/41935ac1-8c77-4b88-aca4-b2a59a3a6f05" />

---

### Step 37: Verify Success (Send & Receive)

**Command/Action:** Write and send an email to `dineesh@bungkus.org`.

**Purpose:** Verifies the complete functional flow of the mail server (sending via SMTP and receiving via IMAP).

**Result:** The test email is sent and successfully appears in the Inbox.

<img width="966" height="327" alt="image" src="https://github.com/user-attachments/assets/c2eb899f-b8ba-4c1d-9eb5-17303f6c2c40" />

<img width="1718" height="491" alt="image" src="https://github.com/user-attachments/assets/73ab8fce-239a-4666-8ed5-7e52c4a8ff2c" />

<img width="2333" height="426" alt="image" src="https://github.com/user-attachments/assets/76fa8ee6-0c3f-4d84-aa47-6e7a9d33781c" />

---

---

## üéä LAB COMPLETE

You have successfully:

- ‚úÖ Configured a complete Postfix + Dovecot mail server on Rocky Linux
- ‚úÖ Generated and configured SSL/TLS certificates
- ‚úÖ Configured all SMTP ports (25, 465, 587) and IMAP ports (143, 993)
- ‚úÖ Set up client on Ubuntu
- ‚úÖ Connected Thunderbird with SSL/TLS
- ‚úÖ Sent and received encrypted email

---

## üõ†Ô∏è Phase 11: Troubleshooting & Case Studies

### ‚ö†Ô∏è Problem: Internet Connectivity Lost After Hostname Change

**Symptoms:** Immediately after running `hostnamectl`, the Rocky server lost all internet connectivity.

**Diagnosis:**

```bash
ip route  # No default gateway was listed!
```

**Root Cause:** The `hostnamectl` command unexpectedly removed the default gateway from the routing table in the VirtualBox environment.

**Solution:**

```bash
# Restore default gateway (usually .1 or .2 in NAT)
sudo ip route add default via 192.168.200.2 dev enp0s3

# Verify with a web request
curl -I https://google.com
```

---

### ‚ö†Ô∏è Problem: "Failed to Find Settings" Error

<img width="681" height="1012" alt="image" src="https://github.com/user-attachments/assets/5724ade8-8b57-4660-b3b7-95aec717e01d" />

**Symptoms:** Thunderbird displays "Thunderbird failed to find the settings for your email account."

**Root Cause:** Auto-detection scripts couldn't verify the self-signed certificate or ports automatically.

**Solution:** Use **Manual Configuration** and explicitly set:

- **Incoming:** Port 993, SSL/TLS, Normal Password
- **Outgoing:** Port 465, SSL/TLS, Normal Password
- **Username:** `dineesh` (System username, not the full email)

---

### ‚ö†Ô∏è Problem: "No Information Available" Certificate Hang

<img width="481" height="138" alt="image" src="https://github.com/user-attachments/assets/336fb71c-181e-45ac-bad6-68d7912c629b" />
<img width="481" height="138" alt="image" src="https://github.com/user-attachments/assets/d84b4cec-b248-49b6-819a-97da05ae3659" />

**Symptoms:** Thunderbird hangs indefinitely at "Unable to obtain identification status for this site."

**Root Cause:** Thunderbird is attempting to use **OCSP (Online Certificate Status Protocol)** to validate the certificate. Since the certificate is self-signed, there is no external CA to respond, causing a timeout loop.

**Solution:**

1. Go to **Settings** > **Privacy & Security**.
2. Search for **OCSP**.
3. Uncheck **"Query OCSP responder servers to confirm the current validity of certificates"**.

---

### ‚ö†Ô∏è Problem: "Checking Password" Infinite Loop

<img width="661" height="336" alt="image" src="https://github.com/user-attachments/assets/dda5c38a-a6bf-4e87-8449-0641f849fe5d" />

**Symptoms:** Even after accepting the certificate, Thunderbird stays on "Checking password..." forever.

**Root Cause:** Often caused by using the wrong username format (e.g., `dineesh@bungkus.org` instead of just `dineesh`) or the OCSP hang mentioned above.

**Solution:** Ensure the Username field is just your Linux system username and that OCSP is disabled.

---

### ‚ö†Ô∏è Problem: Symlink Path Error

**Symptoms:** `thunderbird` command not found after "installation".

**Fix:**

```bash
sudo ln -sf /opt/thunderbird/thunderbird /usr/bin/thunderbird
```

The `-sf` flag forces the creation of the link and overwrites any existing broken links.

---

## üí° Expert Insights & Best Practices

- **Networking:** ICMP (ping) is often blocked in NAT networks. Use `curl` or `openssl s_client` for reliable testing.
- **SSL/TLS:** Self-signed certificates MUST have a Common Name (CN) matching the FQDN exactly.
- **Authentication:** Mail servers authenticate against system users. Ensure the user has a valid password set with `passwd`.
- **Methodology:** Test locally on the server first using `openssl s_client` before adding the complexity of a GUI client.

---

**Good luck with your lab documentation! You've got this! üöÄ**
